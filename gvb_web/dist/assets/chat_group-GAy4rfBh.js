import{S as O,c as R,r as T,d as r,f as g,e,A as k,F as z,q as J,z as V,B as A,w as p,h,o as _,t as d,s as b,l as v,n as E,i as F}from"./index-CMDvGcfm.js";import{_ as K}from"./gvb_nav-DNQkAbS6.js";import{a as w}from"./data-DE6nU9bg.js";import"./gvb_user_info-D5ARriOV.js";import"./logout-7pvh7eQ6.js";import"./user_api-Da9nH9Ud.js";import"./article_api-Dh3ZF_NR.js";function W(f){return O.get("/api/chat_groups_records",{params:f})}const I={class:"base_view chat_group_view"},L={class:"gvb_inner_container"},U=e("div",{class:"gvb_chat_head"},[e("div",{class:"title"},"在线聊天室"),e("div",{class:"people_num"},"在线人数： 1")],-1),q={key:0,class:"in_room_msg"},D={key:1,class:"out_room_msg"},G={class:"avatar"},P=["src"],$={class:"message-main"},Q={class:"message-user"},X={class:"message-content"},Y={class:"content"},Z={class:"txt-message"},j=e("div",{class:"gvb_chat_menu"},[e("span",null,[e("i",{class:"fa fa-cloud-upload"})]),e("span",null,[e("i",{class:"fa fa-file-image-o"})]),e("span",null,[e("i",{class:"fa fa-file-audio-o"})])],-1),ee={class:"gvb_chat_footer"},x=1,S=2,H=7,ie={__name:"chat_group",setup(f){let a=null,m=0;const u=R(null),s=T({allHeight:"100vh",setHeight:"597px",message_list:[],user_info:{nick_name:"",avatar:""},content:""});async function N(){let o=document.documentElement.scrollHeight;s.allHeight=o+"px";let c=o-340;s.setHeight=c+"px";let l=await W({limit:50});s.message_list=l.data.list,s.message_list.reverse();let i;a=new WebSocket(i+"/api/chat_groups"),a.onmessage=B,a.onopen=function(n){var t={content:"",msg_type:x};a.send(JSON.stringify(t)),console.log("onopen: ",n)},a.onclose=function(n){var t={content:"",msg_type:H};a.send(JSON.stringify(t)),console.log("onopen: ",n)},a.onerror=function(n){console.log("onerror: ",n)},a.onclose=function(n){console.log("onclose: ",n)}}function B(o){let c=o.data,l=JSON.parse(c);if(m===0){s.user_info.nick_name=l.nick_name,m++;return}C(l),m++}function C(o){console.log(o),o.nick_name===s.user_info.nick_name&&(o.is_me=!0),s.message_list.push(o),s.message_list=[...s.message_list]}function y(){let o={content:s.content,msg_type:S};a.readyState===WebSocket.OPEN?(a.send(JSON.stringify(o)),s.content=""):console.error("WebSocket is not open. Current state: "+a.readyState),setTimeout(()=>{let c=u.value.scrollHeight,l=u.value.clientHeight,i=null;i=setInterval(()=>{let n=u.value.scrollTop;if(c<=n+l){clearInterval(i);return}u.value.scrollTop+=20},5)},100)}return N(),(o,c)=>{const l=h("a-tooltip"),i=h("a-textarea"),n=h("a-button");return _(),r("div",I,[g(K,{is_show:""}),e("div",{class:"gvb_base_container",style:k({height:s.allHeight})},[e("div",L,[U,e("div",{class:"gvb_chat_body",ref_key:"chatBody",ref:u,style:k({height:s.setHeight})},[(_(!0),r(z,null,J(s.message_list,(t,M)=>(_(),r("div",{class:"message",key:M},[t.msg_type===x?(_(),r("div",q,[g(l,{placement:"top"},{title:p(()=>[e("span",null,d(b(w)(t.created_at)),1)]),default:p(()=>[e("span",null,d(t.content),1)]),_:2},1024)])):v("",!0),t.msg_type===H?(_(),r("div",D,[g(l,{placement:"top"},{title:p(()=>[e("span",null,d(b(w)(t.created_at)),1)]),default:p(()=>[e("span",null,d(t.content),1)]),_:2},1024)])):v("",!0),t.msg_type===S?(_(),r("div",{key:2,class:E({me:t.is_me})},[e("div",G,[e("img",{src:t.avatar,alt:""},null,8,P)]),e("div",$,[e("div",Q,d(t.nick_name),1),e("div",X,[e("div",Y,[e("div",Z,d(t.content),1)])])])],2)):v("",!0)]))),128))],4),j,e("div",ee,[g(i,{value:s.content,"onUpdate:value":c[0]||(c[0]=t=>s.content=t),placeholder:"发送你的消息，聊起来吧",onKeydown:V(A(y,["ctrl"]),["enter"]),"auto-size":{minRows:4,maxRows:4}},null,8,["value","onKeydown"]),g(n,{onClick:y,class:"chat_btn"},{default:p(()=>[F("发送")]),_:1})])])],4)])}}};export{ie as default};
