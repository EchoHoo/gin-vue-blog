import{b as j,u as H,r as I,h as w,o as d,d as p,F as K,q as L,e as t,t as i,s as u,f as m,w as D,l as x,z as G,B as P,i as A,g as r,c as z,v as O,k as N,A as W,n as R}from"./index-Sy54AUqK.js";import{_ as J}from"./gvb_nav-D6tPe57c.js";import{_ as Q}from"./gvb_banner-N4AA-fZ1.js";import{G as X}from"./gvb_footer-BdINLbkm.js";import{a as Y,b as Z,c as tt}from"./article_api-BZl38PjZ.js";import{a as B}from"./data-DE6nU9bg.js";import{M as et,a as ot}from"./index-CYFOkxZD.js";/* empty css              */import{g as st,c as U,a as nt}from"./comment_api-BA7ZwNRl.js";import"./gvb_user_info-CXx7kPbn.js";import"./logout-BLHPZz8O.js";import"./user_api-DTTuHnnK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ct={class:"gvb_article_comment_list"},it={class:"avatar"},at=["src"],lt={class:"comment"},rt={class:"name"},_t={class:"comment_content"},dt={class:"info"},ut={class:"date"},mt=["onClick"],pt={key:0,class:"delete"},ft={class:"sub_comment_list"},ht={class:"sub_avatar"},gt=["src"],vt={class:"sub_comment"},yt={class:"line"},bt={class:"name"},kt={class:"content"},wt={class:"info"},Ct={class:"date"},$t=["onClick"],Tt={key:1,class:"sub_comment_apply"},xt=["src"],At={__name:"gvb_article_comment_list",setup(q,{expose:h}){const g=j(),y=H().params.id,v=I({list:[{article_id:"",comment_count:0,comment_model:"",content:"",digg_count:0,parent_comment_id:0,sub_comments:[],model:{id:"",created_at:""},user:{addr:"",avatar:"",created_at:"",email:"",id:0,integral:0,ip:"",link:"",nick_name:"",role:1,sign:"",sign_status:1,tel:"",token:"",user_name:""},user_id:0}]}),l=I({article_id:y,content:"",parent_comment_id:null,nick_name:""}),f=g.userInfo.role,C=g.userInfo.user_id;async function e(){let a=await st(y);v.list=S(a.data),console.log(v.list)}function S(a){return a.map(c=>(c.created_at=B(c.created_at),c.sub_comments&&c.sub_comments.length>0&&(c.sub_comments=S(c.sub_comments)),c))}function M(a,c){if(g.userInfo.role===0){r.warn("请先登录");return}console.log("Called showApply with parentID:",a,"and nickName:",c),a||console.error("parentID is undefined"),l.content="",l.parent_comment_id=a,l.nick_name=c}async function V(){if(l.content.trim()===""){r.warn("评论内容不可为空");return}let a=await U(l);if(a.code){r.error(a.msg);return}r.success(a.msg),l.content="",e()}async function $(a){let c=await nt(a);if(c.code){r.error(c.msg);return}r.success(c.msg),e()}return h({getData:e}),e(),console.log(v.list),(a,c)=>{const T=w("a-popconfirm"),o=w("a-input"),_=w("a-button");return d(),p("div",ct,[(d(!0),p(K,null,L(v.list,n=>(d(),p("div",{class:"gvb_comment_item",key:n.model.id},[t("div",it,[t("img",{src:n.user.avatar,alt:""},null,8,at)]),t("div",lt,[t("div",rt,i(n.user.nick_name),1),t("div",_t,i(n.content),1),t("div",dt,[t("span",ut,i(u(B)(n.model.created_at)),1),t("span",{class:"apply",onClick:s=>M(n.model.id,n.user.nick_name)},"回复 ("+i(n.comment_count)+")",9,mt),m(T,{title:"确定删除这条评论吗","ok-text":"删除","cancel-text":"取消",onConfirm:s=>$(n.model.id)},{default:D(()=>[u(f)===1||u(C)===n.user_id?(d(),p("span",pt,"删除")):x("",!0)]),_:2},1032,["onConfirm"])]),t("div",ft,[n.sub_comments.length?(d(!0),p(K,{key:0},L(n.sub_comments,s=>(d(),p("div",{class:"sub_comment_item",key:s.model.id},[t("div",ht,[t("img",{src:s.user.avatar,alt:""},null,8,gt)]),t("div",vt,[t("div",yt,[t("span",bt,i(s.user.nick_name),1),t("span",kt,i(s.content),1)]),t("div",wt,[t("span",Ct,i(u(B)(s.model.created_at)),1),m(T,{title:"确定删除这条评论吗","ok-text":"删除","cancel-text":"取消",onConfirm:b=>$(s.model.id)},{default:D(()=>[u(f)===1||u(C)===s.user_id?(d(),p("span",{key:0,class:"delete",onClick:b=>$(s.model.id)},"删除",8,$t)):x("",!0)]),_:2},1032,["onConfirm"])])])]))),128)):x("",!0),l.parent_comment_id===n.model.id?(d(),p("div",Tt,[t("img",{src:u(g).userInfo.avatar,alt:"",class:"user_avatar"},null,8,xt),m(o,{class:"comment_ipt",onKeydown:G(P(V,["ctrl"]),["enter"]),value:l.content,"onUpdate:value":c[0]||(c[0]=s=>l.content=s),placeholder:"回复 @ "+l.nick_name},null,8,["onKeydown","value","placeholder"]),m(_,{type:"primary",onClick:V},{default:D(()=>[A("回复")]),_:1})])):x("",!0)])])]))),128))])}}};function It(q){let h=null;h=setInterval(()=>{if(document.documentElement.scrollTop>=q){console.log("清除定时器"),clearInterval(h);return}document.documentElement.scrollTop+=20},5)}const Dt={class:"base_view article_view"},Et={style:{height:"600px"}},St={class:"gvb_base_container"},Vt={class:"gvb_inner_container"},Bt=t("div",{class:"go_top_box",style:{position:"absolute",top:"540px"}},null,-1),qt={class:"article_head"},Mt={class:"info"},zt={class:"date"},Kt={class:"tag"},Lt=t("i",{title:"文章标签",class:"fa fa-tags"},null,-1),Nt={class:"article_content"},Rt=t("div",{class:"article_on_the"},[t("div",{class:"article_on_the_inner"},[t("a",{href:"#"},"上一篇"),t("a",{href:"#"},"下一篇")])],-1),Ft={class:"article_comment_to"},Ht=t("div",{class:"title"},"你觉得文章怎么样",-1),Gt={class:"body"},Pt={class:"comment_footer"},Ut={class:"article_user_info"},jt={class:"user_info_avatar"},Ot=["src"],Wt={class:"user_info_info"},Jt={class:"user_name"},Qt=t("div",{class:"user_abstract"}," 一个疯狂的coder ",-1),Xt=t("div",{class:"user_link"},[t("a",{href:"#"},[t("i",{class:"fa fa-github-square"})])],-1),Yt={class:"article_data"},Zt={class:"item"},te=t("span",null,"浏览",-1),ee={class:"item"},oe=t("span",null,"收藏",-1),se={class:"item"},ne=t("span",null,"点赞",-1),ce={class:"item"},ie=t("span",null,"评论",-1),ae={class:"article_directory"},le=t("div",{class:"title"}," 文章目录 ",-1),re={class:"body"},_e={class:"article_action"},de=t("i",{class:"iconfont icon-dianzan"},null,-1),ue=[de],me=t("i",{class:"iconfont icon-shoucang"},null,-1),pe=[me],fe=t("i",{class:"iconfont icon-dingbu"},null,-1),he=[fe],ge=t("i",{class:"iconfont icon-dibu"},null,-1),ve=[ge],F="preview-only-po",Ve={__name:"article",setup(q){const h=z(null),g=document.documentElement,E=z(null),y=H(),v=z(),l=I({position:"inherit",width:"auto",top:"60px"}),f=I({article_id:y.params.id,content:"",parent_comment_id:null});async function C(){if(f.content.trim()===""){r.warn("评论内容不能为空");return}let o=await U(f);if(o.code){r.error(o.msg);return}r.success(o.msg),f.content="",h.value.getData()}const e=I({abstract:"",banner_id:0,banner_url:"",category:"",collects_count:0,comment_count:0,content:"",created_at:"",digg_count:0,id:"",keyword:"",link:"",look_count:0,source:"",tags:[],title:"",updated_at:"",user_avatar:"",user_id:0,user_nick_name:"",is_collect:!1,is_digg:!1});async function S(){let o=await Y(y.params.id);if(o.code){r.error(o.msg);return}Object.assign(e,o.data)}function M(){(document.scrollingElement.scrollTop||document.body.scrollTop)>=v.value?l.position="fixed":l.position="inherit"}async function V(){let o=await Z(e.id);if(o.code){r.error(o.msg);return}r.success(o.msg),e.is_digg=!0,e.digg_count++,setTimeout(()=>{e.is_digg=!1},1e3)}async function $(){console.log(e.id);let o=await tt(e.id);if(o.code){r.error(o.msg);return}r.success(o.msg),e.is_collect=!e.is_collect}O(()=>{v.value=E.value.offsetTop-38,l.width=E.value.scrollWidth+"px";let o=document.querySelector(".md-editor-catalog ");window.addEventListener("scroll",M),setTimeout(()=>{o.scrollHeight;let s=document.documentElement.offsetHeight-470;document.querySelector(".article_directory .body").style.maxHeight=s+"px"},100);let _=y.hash;console.log(_),_!=""&&setTimeout(()=>{let n=document.querySelector(_);console.log(_);let s=n.getBoundingClientRect().top;It(s-80)},800)});function a(){T(".article_comment_ipt"),setTimeout(()=>{document.querySelector(".article_comment_ipt").focus()},800)}function c(){T(".go_top_box")}function T(o){const _=document.querySelector(o),n=_.offsetTop;if(typeof window.getComputedStyle(document.body).scrollBehavior>"u"){let s=document.documentElement.scrollTop||document.body.scrollTop;const b=function(){let k=n-s;s=s+k/5,Math.abs(k)<1?window.scrollTo(0,n):(window.scrollTo(0,s),setTimeout(b,20))};b()}else _.scrollIntoView({behavior:"smooth",inline:"nearest"})}return S(),(o,_)=>{const n=w("a-tag"),s=w("a-textarea"),b=w("a-button");return d(),p("div",Dt,[m(J),t("div",Et,[e.title!==""?(d(),N(Q,{key:0,url:e.banner_url,slogan:e.title,abstract:e.abstract,"is-article":""},null,8,["url","slogan","abstract"])):x("",!0)]),t("div",St,[t("div",Vt,[Bt,t("article",null,[t("div",qt,[t("h2",null,i(e.title),1),t("div",Mt,[t("span",zt,"发布时间："+i(u(B)(e.created_at)),1),t("span",null,"作者："+i(e.user_nick_name),1)]),t("div",Kt,[Lt,(d(!0),p(K,null,L(e.tags,k=>(d(),N(n,{color:"red"},{default:D(()=>[A(i(k),1)]),_:2},1024))),256))])]),t("div",Nt,[m(u(et),{editorId:F,modelValue:e.content},null,8,["modelValue"])]),Rt,t("div",Ft,[Ht,t("div",Gt,[m(s,{class:"article_comment_ipt",value:f.content,"onUpdate:value":_[0]||(_[0]=k=>f.content=k),"auto-size":{minRows:6,maxRows:6},placeholder:"请输入文章评论",onKeydown:G(P(C,["ctrl"]),["enter"])},null,8,["value","onKeydown"]),m(b,{class:"add_comment_btn",onClick:C,type:"primary"},{default:D(()=>[A("发布")]),_:1})]),t("div",Pt,[t("span",null,i(e.look_count),1),A(" 人参与， "),t("span",null,i(e.comment_count),1),A(" 条评论 ")])]),m(At,{ref_key:"gvbArticleCommentList",ref:h},null,512)]),t("aside",null,[t("div",Ut,[t("div",jt,[t("img",{src:e.user_avatar,alt:""},null,8,Ot)]),t("div",Wt,[t("div",Jt,i(e.user_nick_name),1),Qt]),Xt,t("div",Yt,[t("div",Zt,[t("span",null,i(e.look_count),1),te]),t("div",ee,[t("span",null,i(e.collects_count),1),oe]),t("div",se,[t("span",null,i(e.digg_count),1),ne]),t("div",ce,[t("span",null,i(e.comment_count),1),ie])])]),t("div",{class:"article_directory_action",ref_key:"article_directory",ref:E,style:W(l)},[t("div",ae,[le,t("div",re,[m(u(ot),{ref:"articleCatalog",editorId:F,"scroll-element":u(g),"scroll-element-offset-top":80,offsetTop:100},null,8,["scroll-element"])])]),t("div",_e,[t("div",{class:R({item:!0,active:e.is_digg}),onClick:V},ue,2),t("div",{class:R({item:!0,active:e.is_collect}),onClick:$},pe,2),t("div",{class:"item",onClick:c},he),t("div",{class:"item",onClick:a},ve)])],4)])])]),m(X)])}}};export{Ve as default};
