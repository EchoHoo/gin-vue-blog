import{_ as K}from"./gvb_table-DwXhQnu9.js";import{i as S}from"./image_api-CdPAa1or.js";import{c,r as C,d,f as n,w as s,K as G,L as H,g as L,h as i,o as r,e as k,F as y,q as h,k as J,t as N,i as R,l as B}from"./index-Sy54AUqK.js";import"./data-DE6nU9bg.js";const P=["src"],Q=["src"],W={key:0,style:{display:"grid","grid-template-columns":"repeat(3,1fr)","grid-column-gap":"5px"}},X={key:1,style:{display:"grid","grid-template-columns":"repeat(3,1fr)","grid-row-gap":"5px","grid-column-gap":"5px"}},Y=["src"],se={__name:"menu_list",setup(Z){const m=c(""),x=c(null),p=c([]),I=c(null),D={abstract_time:7,banner_time:7,path:"",slogan:"",sort:1,title:"",abstract:[],image_sort_list:[]},a=C({abstract_time:7,banner_time:7,path:"",slogan:"",sort:1,title:"",abstract:[],image_sort_list:[]}),o=C({columns:[{title:"id",key:"id",dataIndex:"id"},{title:"菜单标题",key:"title",dataIndex:"title"},{title:"路径",key:"path",dataIndex:"path"},{title:"slogan",key:"slogan",dataIndex:"slogan"},{title:"介绍",key:"abstract",dataIndex:"abstract"},{title:"介绍切换时间",key:"abstract_time",dataIndex:"abstract_time"},{title:"banner切换时间",key:"banner_time",dataIndex:"banner_time"},{title:"排序",key:"sort",dataIndex:"sort"},{title:"banner",key:"banners",dataIndex:"banners"},{title:"发布时间",key:"created_at",dataIndex:"created_at"},{title:"操作",key:"action",dataIndex:"action"}],visible:!1,imageNameList:[]});function M(l){return l[0].props.src}function V(l){a.image_sort_list=[];for(let e=0;e<l.length;e++)a.image_sort_list.push({image_id:l[e],sort:e})}async function q(){let l=await S();o.imageNameList=l.data}q();function A(){Object.assign(a,D),b.value=0,o.visible=!0}async function O(){try{x.value.validate()}catch{return}a.abstract=m.value.split(`
`);let l;if(b.value?l=await G(b.value,a):l=await H(a),l.code){L.error(l.msg);return}L.success(l.msg),o.visible=!1,m.value="",p.value=[],I.value.ExportList(),console.log(a)}const b=c(0);function T(l){b.value=l.id,a.title=l.title,a.path=l.path,a.slogan=l.slogan,a.sort=l.sort,a.abstract_time=l.abstract_time,a.banner_time=l.banner_time,m.value=l.abstract.join(`
`),p.value=[],a.image_sort_list=[];for(let e=0;e<l.banners.length;e++)p.value.push(l.banners[e].id),a.image_sort_list.push({image_id:l.banners[e].id,sort:e});o.visible=!0}return(l,e)=>{const v=i("a-input"),u=i("a-form-item"),j=i("a-textarea"),f=i("a-input-number"),z=i("a-select-option"),E=i("a-select"),F=i("a-form"),$=i("a-modal"),U=i("a-button");return r(),d("div",null,[n($,{title:b.value?"编辑菜单":"添加菜单",visible:o.visible,"onUpdate:visible":e[8]||(e[8]=t=>o.visible=t),onOk:O},{default:s(()=>[n(F,{model:a,name:"basic",ref_key:"formRef",ref:x,"label-col":{span:8},"wrapper-col":{span:20},autocomplete:"off"},{default:s(()=>[n(u,{label:"菜单名称",name:"title","has-feedback":"",rules:[{required:!0,message:"请输入菜单名称",trigger:"blur"}]},{default:s(()=>[n(v,{value:a.title,"onUpdate:value":e[0]||(e[0]=t=>a.title=t),placeholder:"菜单名称"},null,8,["value"])]),_:1}),n(u,{label:"菜单路径",name:"path","has-feedback":"",rules:[{required:!0,message:"请输入菜单路径",trigger:"blur"}]},{default:s(()=>[n(v,{value:a.path,"onUpdate:value":e[1]||(e[1]=t=>a.path=t),placeholder:"菜单路径"},null,8,["value"])]),_:1}),n(u,{label:"slogan",name:"slogan","has-feedback":""},{default:s(()=>[n(v,{value:a.slogan,"onUpdate:value":e[2]||(e[2]=t=>a.slogan=t),placeholder:"slogan"},null,8,["value"])]),_:1}),n(u,{label:"菜单简介",name:"abstract","has-feedback":""},{default:s(()=>[n(j,{value:m.value,"onUpdate:value":e[3]||(e[3]=t=>m.value=t),name:"abstract",placeholder:"菜单简介，支持多行","auto-size":{minRows:2,maxRows:6}},null,8,["value"])]),_:1}),n(u,{label:"banner时间",name:"banner_time","has-feedback":""},{default:s(()=>[n(f,{value:a.banner_time,"onUpdate:value":e[4]||(e[4]=t=>a.banner_time=t),placeholder:"banner时间"},null,8,["value"])]),_:1}),n(u,{label:"简介时间",name:"abstract_time","has-feedback":""},{default:s(()=>[n(f,{value:a.abstract_time,"onUpdate:value":e[5]||(e[5]=t=>a.abstract_time=t),placeholder:"abstract_time"},null,8,["value"])]),_:1}),n(u,{label:"序号",name:"sort","has-feedback":""},{default:s(()=>[n(f,{value:a.sort,"onUpdate:value":e[6]||(e[6]=t=>a.sort=t),placeholder:"请输入序号"},null,8,["value"])]),_:1}),n(u,{label:"banner选择"},{default:s(()=>[n(E,{value:p.value,"onUpdate:value":e[7]||(e[7]=t=>p.value=t),placeholder:"请选择banner",mode:"multiple",onChange:V},{tagRender:s(({value:t,label:_,closable:g,onClose:w,option:ee})=>[k("img",{src:M(_),height:"30",style:{"border-radius":"5px","margin-right":"10px"}},null,8,Q)]),default:s(()=>[(r(!0),d(y,null,h(o.imageNameList,t=>(r(),J(z,{key:t.id,value:t.id},{default:s(()=>[k("img",{src:t.path,alt:"",height:"30",style:{"border-radius":"5px","margin-right":"10px"}},null,8,P),k("span",null,N(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"]),n(K,{columns:o.columns,baseURL:"/api/menus",ref_key:"gvbTable",ref:I,"page-size":7,"like-title":"搜索菜单昵称","default-delete":""},{add:s(()=>[n(U,{type:"primary",onClick:A},{default:s(()=>[R("添加菜单")]),_:1})]),edit:s(({record:t})=>[n(U,{type:"primary",onClick:_=>T(t)},{default:s(()=>[R("编辑")]),_:2},1032,["onClick"])]),cell:s(({column:t,record:_})=>[t.key==="abstract"?(r(),d("div",W,[(r(!0),d(y,null,h(_.abstract,(g,w)=>(r(),d("div",{key:w},N(g),1))),128))])):B("",!0),t.key==="banners"?(r(),d("div",X,[(r(!0),d(y,null,h(_.banners,g=>(r(),d("img",{key:l.index,src:g.path,style:{height:"40px","border-radius":"5px"}},null,8,Y))),128))])):B("",!0)]),_:1},8,["columns"])])}}};export{se as default};
